<%= render '/layouts/ag2_products/receipts_deliveries_productbreadcrumb' %>

<table class="header-with-image">
  <tr>
    <td class="header-title">
      <h3><%= t '.title' %></h3>
    </td>
    <td class="header-image">
      <span class="highlighted bolded"><%= @product.full_name %></span>
    </td>
  </tr>
</table>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span12" id="div_table">

      <!-- Receipts -->
      <h4><%= t :"activerecord.attributes.product.receipts" %></h4>
      <% if (@receipts.count > 0) %>
      <table class="table table-condensed table-striped">
        <!-- id -->
        <col width="5%" />
        <!-- date -->
        <col width="10%" />
        <!-- no -->
        <col width="12%" />
        <!-- store -->
        <col width="29%" />
        <!-- quantity -->
        <col width="11%" />
        <!-- price -->
        <col width="11%" />
        <!-- discount -->
        <col width="11%" />
        <!-- amount -->
        <col width="11%" />
        <thead>
          <tr>
            <th>Id</th>
            <th align="center"><%= t 'activerecord.attributes.receipt_note.receipt_date' %></th>
            <th><%= t :"activerecord.attributes.receipt_note.receipt_no" %></th>
            <th><%=t "activerecord.attributes.receipt_note_item.store" %></th>
            <th align="right"><%=t "activerecord.attributes.receipt_note_item.quantity_c" %></th>
            <th align="right"><%= t "activerecord.attributes.receipt_note_item.price_c" %></th>
            <th align="right"><%= t "activerecord.attributes.receipt_note_item.discount_c" %></th>
            <th align="right"><%=t "activerecord.attributes.receipt_note_item.amount_c" %></th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td align="right"><%= t :"activerecord.attributes.product.stock" %></td>
            <td align="right"><%= number_with_precision(@product.receipts, precision: 4) unless @product.receipts.blank? %></td>
            <td align="right"><%= number_with_precision(@product.receipts_price_avg, precision: 4) unless @product.receipts_price_avg.blank? %></td>
            <td align="right"><%= number_with_precision(@product.receipts_discount, precision: 4) unless @product.receipts_discount.blank? %></td>
            <td align="right"><%= number_with_precision(@product.receipts_amount, precision: 4) unless @product.receipts_amount.blank? %></td>
          </tr>
        </tfoot>
        <tbody>
          <% @receipts.each do |m| %>
          <tr>
            <td><%= m.id %></td>
            <td align="center"><%= formatted_date(m.receipt_note.receipt_date) unless m.receipt_note.receipt_date.blank? %></td>
            <td><%= m.receipt_note.receipt_no %></td>
            <td><%= m.store.name unless m.store.blank? %></td>
            <td align="right"><%= number_with_precision(m.quantity, precision: 4) unless m.quantity.blank? %></td>
            <td align="right"><%= number_with_precision(m.price, precision: 4) unless m.price.blank? %></td>
            <td align="right"><%= number_with_precision(m.discount, precision: 4) unless m.discount.blank? %></td>
            <td align="right"><%= number_with_precision(m.amount, precision: 4) unless m.amount.blank? %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
      <% end %>
      <%= render :partial => '/layouts/pagination', :locals => { :ivar => @receipts } %>

      <!-- Deliveries -->
      <h4><%= t :"activerecord.attributes.product.deliveries" %></h4>
      <% if (@deliveries.count > 0) %>
      <table class="table table-condensed table-striped">
        <!-- id -->
        <col width="5%" />
        <!-- date -->
        <col width="10%" />
        <!-- no -->
        <col width="12%" />
        <!-- store -->
        <col width="29%" />
        <!-- quantity -->
        <col width="11%" />
        <!-- price -->
        <col width="11%" />
        <!-- discount -->
        <col width="11%" />
        <!-- amount -->
        <col width="11%" />
        <thead>
          <tr>
            <th>Id</th>
            <th align="center"><%= t 'activerecord.attributes.delivery_note.delivery_date' %></th>
            <th><%= t :"activerecord.attributes.delivery_note.delivery_no" %></th>
            <th><%=t "activerecord.attributes.delivery_note_item.store" %></th>
            <th align="right"><%=t "activerecord.attributes.delivery_note_item.quantity_c" %></th>
            <th align="right"><%= t "activerecord.attributes.delivery_note_item.price_c" %></th>
            <th align="right"><%= t "activerecord.attributes.delivery_note_item.discount_c" %></th>
            <th align="right"><%=t "activerecord.attributes.delivery_note_item.amount_c" %></th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td align="right"><%= t :"activerecord.attributes.product.stock" %></td>
            <td align="right"><%= number_with_precision(@product.deliveries, precision: 4) unless @product.deliveries.blank? %></td>
            <td align="right"><%= number_with_precision(@product.deliveries_price_avg, precision: 4) unless @product.deliveries_price_avg.blank? %></td>
            <td align="right"><%= number_with_precision(@product.deliveries_discount, precision: 4) unless @product.deliveries_discount.blank? %></td>
            <td align="right"><%= number_with_precision(@product.deliveries_amount, precision: 4) unless @product.deliveries_amount.blank? %></td>
          </tr>
        </tfoot>
        <tbody>
          <% @deliveries.each do |m| %>
          <tr>
            <td><%= m.id %></td>
            <td align="center"><%= formatted_date(m.delivery_note.delivery_date) unless m.delivery_note.delivery_date.blank? %></td>
            <td><%= m.delivery_note.full_no %></td>
            <td><%= m.store.name unless m.store.blank? %></td>
            <td align="right"><%= number_with_precision(m.quantity, precision: 4) unless m.quantity.blank? %></td>
            <td align="right"><%= number_with_precision(m.price, precision: 4) unless m.price.blank? %></td>
            <td align="right"><%= number_with_precision(m.discount, precision: 4) unless m.discount.blank? %></td>
            <td align="right"><%= number_with_precision(m.amount, precision: 4) unless m.amount.blank? %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
      <% end %>
      <%= render :partial => '/layouts/pagination', :locals => { :ivar => @deliveries } %>

      <%= link_to t(".return_to"), @product %>
    </div><!-- /.span12 -->
  </div><!-- /.row-fluid -->
</div><!-- /.container-fluid -->
