// Current localization
_currentLocale = '<%= I18n.locale %>'
if (_currentLocale == 'es') {
  _delimiter = '.';
  _separator = ',';
} else {
  _delimiter = ',';
  _separator = '.';
}

$('#pendings').html("<%= escape_javascript(render('bills_pendings')) %>");
// $('#unpaid').html("<%#= escape_javascript(render('bills_unpaid')) %>");
$('#charged').html("<%= escape_javascript(render('bills_charged')) %>");
$('#cash').html("<%= escape_javascript(render('payments_cash')) %>");
$('#banks').html("<%= escape_javascript(render('payments_bank')) %>");
$('#others').html("<%= escape_javascript(render('payments_other')) %>");
$('#fractionated').html("<%= escape_javascript(render('instalments')) %>");

$('.accor').click(function () {
  if (this.classList.contains("collapsed")){
    this.children[0].className = "icon-minus";
  }else {
    this.children[0].className = "icon-plus";
  }
});

$(".btn-payment").click(function(){
  var elements = $( "input:checked" );
  // if (elements.length <= 0) return false;
  var invoices_id = [];
  var debts_array = [];
  for(var i=0;typeof(elements[i])!='undefined';invoices_id.push(elements[i++].getAttribute('value')));
  for(var i=0;typeof(elements[i])!='undefined';debts_array.push(elements[i++].getAttribute('data-debt')));
  var total_debt = 0.0;
  for (var i = 0; i < debts_array.length; i++) {
    if(debts_array[i] != null){
      total_debt += parseFloat(debts_array[i]);
    }
  }
  $(".debt-total").text(total_debt.format(4, 3, _delimiter, _separator));

  // Update Ids in the
  $("#client_payment_invoices_ids").val(invoices_id.filter(i=>i!=null))         // cash
  $("#client_payment_other_invoices_ids").val(invoices_id.filter(i=>i!=null))   // others
  $("#client_payment_bank_invoices_ids").val(invoices_id.filter(i=>i!=null))    // bank
  $("#instalment_invoices_ids").val(invoices_id.filter(i=>i!=null))             // instalments
});

// $(".btn-others").click(function (e) {
//   $(".client_payment_payment_method_id").show();
//   $("#client_payment_payment_method_id").prop('disabled', false);
// });

// $(".btn-cash").click(function (e) {
//   $(".client_payment_payment_method_id").hide();
//   $("#client_payment_payment_method_id").prop('disabled', true);
// });

$(".checkbox-master").click(function () {
  $(this).parents(".accordion").find("tbody").find("input[type=checkbox]").prop('checked', $(this).prop('checked'));
});

$(".checkbox-master-table").click(function () {
  $(this).parents(".table").find("tbody").find("input[type=checkbox]").prop('checked', $(this).prop('checked'));
});

$(".checkbox-main").click(function () {
  $(".checkbox-slave, .checkbox-master:not(:disabled)").prop('checked', $(this).prop('checked'));
});

$("#client_payment_amount").change(function() {
  amount = parseFloat(this.value) || 0;
  debt = parseFloat($(this).parents(".modal").find(".debt-total").text().replace(",", ".")) || 0;
  cash_return = debt - amount;
  $(".cash-return").text(cash_return.format(2, 3, _delimiter, _separator));
});

$("#initial-cash").change(function() {
  initial_cash = parseFloat(this.value)
  cashed = parseFloat($("#total-cash").text());
  ending_cash = initial_cash + cashed
  $("#ending-cash").text(ending_cash.format(2, 3, _delimiter, _separator));
});

$("form.bank_confirm").submit(function(){
 var $input = $(this).find("input[name='bank_confirm[ids]']");
 var elements = $( "input.checkbox-slave:checked" );
 var client_payment_ids = [];
 for(var i=0;typeof(elements[i])!='undefined';client_payment_ids.push(elements[i++].getAttribute('value')));
 $input.val(client_payment_ids);
});

$("form.payment_fractionated").submit(function(){
 var $input = $(this).find("input[name='payment_fractionated[ids]']");
 var elements = $( "input.checkbox-slave:checked" );
 var instalments_ids = [];
 for(var i=0;typeof(elements[i])!='undefined';instalments_ids.push(elements[i++].getAttribute('value')));
 $input.val(instalments_ids);
});

$("#pages a").on("click", function() {
  $.getScript(this.href);
  return false;
});
