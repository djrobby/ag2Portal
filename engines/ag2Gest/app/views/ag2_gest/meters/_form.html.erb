<script type="text/javascript">
  $(document).ready(function() {
    $('.date_picker').datepicker({
      format : 'dd/mm/yyyy',
      weekStart : 1
    });

    // Select2
    $('select.sel2').select2({
      formatNoMatches: function(m) { return '<%= I18n.t("select2.no_matches") %>'; },
      allowClear: true
    });
  });

</script>

<%= simple_form_for @meter, :html => {:class => 'form-vertical well' } do |f| %>
  <%= f.error_notification %>
  <%= display_base_errors resource %>
  <%#= f.input :organization_id, :as => :hidden, :input_html => { :value => @current_user.organizations.first.id } %>
  <div class="row-fluid">
    <div class="span4">
    <%= f.input :meter_code, :required => true, :autofocus => true, :input_html => { :class => 'x-large-text-field', maxlength: 12 }, :label_html => { :class => 'form-label' } %>
    </div>

    <div class="span4">
      <%= f.association :office, :required => true, label: t('activerecord.attributes.meter.office_id'), collection: (session[:office].blank? ? Office.all : Office.where(id: session[:office]) ), include_blank: nil, :input_html => { :class => 'sel2 x-large-text-field' }, label_method: lambda { |st| st.to_label }, value_method: :id, :label_html => { :class => 'form-label' } %>
    </div>
  </div>

  <div class="row-fluid">

    <div class="span6">
      <%= f.association :meter_model, label: t('activerecord.attributes.meter.meter_model_id'), collection: MeterModel.all(), :input_html => { :class => 'sel2 x-large-text-field' }, label_method: lambda { |st| st.model }, value_method: :id, :label_html => { :class => 'form-label' }%>
    </div>

    <div class="span4">
      <%= f.association :caliber, label: t('activerecord.attributes.meter.caliber_id'), collection: Caliber.all(), :input_html => { :class => 'sel2 x-large-text-field' }, label_method: lambda { |st| st.caliber }, value_method: :id, :label_html => { :class => 'form-label' }%>
    </div>

    <div class="span2">
      <%= f.input :manufacturing_year, :required => true, :autofocus => true, :input_html => { :class => 'x-large-text-field', max: 9999}, :limit => 4, :default => 0, :label_html => { :class => 'form-label' } %>
    </div>

  </div>

  <label class="multi-field-label-two">
    <%= f.input :expiry_date, :start_year => Time.now.year - 100, :end_year => Time.now.year + 100, :as => :string, :input_html => { :value => (f.object.expiry_date.strftime("%d/%m/%Y") if f.object.expiry_date), :class => 'mid-text-field date_picker' }, :label_html => { :class => 'form-label' } %>
  </label>

  <label class="multi-field-label-two">
    <%= f.input :purchase_date, :start_year => Time.now.year - 100, :end_year => Time.now.year + 100, :as => :string, :input_html => { :value => (f.object.purchase_date.strftime("%d/%m/%Y") if f.object.purchase_date), :class => 'mid-text-field date_picker' }, :label_html => { :class => 'form-label' } %>
  </label>

  <label class="multi-field-label-two">
    <%= f.input :first_installation_date, :start_year => Time.now.year - 100, :end_year => Time.now.year + 100, :as => :string, :input_html => { :value => (f.object.first_installation_date.strftime("%d/%m/%Y") if f.object.first_installation_date), :class => 'mid-text-field date_picker' }, :label_html => { :class => 'form-label' } %>
  </label>

  <label class="multi-field-label-two">
    <%= f.association :meter_owner, label: t('activerecord.attributes.meter.meter_owner_id'), collection: MeterOwner.all(), :input_html => { :class => 'sel2 x-large-text-field' }, label_method: lambda { |st| st.name }, value_method: :id, :label_html => { :class => 'form-label' }%>
  </label>

  <br>

  <%= f.button :submit, :class => 'btn-primary' %>

<% end %>
